function setRealContentHeight(){var e=$.mobile.activePage.find("div[data-role='header']:visible"),t=$.mobile.activePage.find("div[data-role='footer']:visible"),i=$.mobile.activePage.find("div.ui-content:visible:visible"),n=$(window).height(),s=n-(e.outerHeight()-1)-(t.outerHeight()-1);i.outerHeight()-e.outerHeight()-t.outerHeight()<=n&&(s-=i.outerHeight()-i.height()),$(".ui-content").height(s)}function get_classement(e,t,i){var n=urls.classement[e],s="";$.each(divisions,function(t,i){i.nom==e&&(s=i)}),""==s&&(t=!0,s={nom:e,equipes:[]},divisions.push(s));var a="";$("#page_classement h1").html("Classement "+e);var o=$("#page_classement .classement tbody");o.empty(),t?(s.equipes=[],$.get(n,function(e){var t=0,n=$(e).find(".classement tbody tr");n.each(function(){var e=$(this);a={},$scores=e.find("td"),a.nom=$($scores[0]).text(),a.joue=$($scores[1]).text(),a.gagne=$($scores[2]).text(),a.egalite=$($scores[3]).text(),a.perdu=$($scores[4]).text(),a.marques=$($scores[5]).text(),a.encaisses=$($scores[6]).text(),a.difference=$($scores[7]).text(),a.points=$($scores[8]).text(),a.link=$($scores[0]).find("a").attr("href"),s.equipes.push(a),o.append("<tr class='equipe'><td><a href='#' class='equipe_link' data-url='"+a.link+"' data-nom='"+a.nom+"'>"+a.nom+"</a></td><td>"+a.joue+"</td><td>"+a.gagne+"</td><td>"+a.egalite+"</td><td>"+a.perdu+"</td><td>"+a.marques+"</td><td>"+a.encaisses+"</td><td>"+a.difference+"</td><td>"+a.points+"</td></tr>")}),division_now=s,i(s.equipes)})):($.each(s.equipes,function(e,t){o.append("<tr class='equipe'><td><a href='#' class='equipe_link' data-url='"+t.link+"' data-nom='"+t.nom+"'>"+t.nom+"</a></td><td>"+t.joue+"</td><td>"+t.gagne+"</td><td>"+t.egalite+"</td><td>"+t.perdu+"</td><td>"+t.marques+"</td><td>"+t.encaisses+"</td><td>"+t.difference+"</td><td>"+t.points+"</td></tr>")}),division_now=s,i(s.equipes))}function get_equipe(e,t,i,n){var s="";Array.isArray(division_now.equipes)&&$.each(division_now.equipes,function(t,i){i.nom==e&&(s=i)}),""==s?(t=!0,s={nom:e,link:i,joueurs:[]},Array.isArray(division_now.equipes)&&division_now.equipes.push(s)):Array.isArray(s.joueurs)||(t=!0,s.joueurs=[]),$("#page_equipe h1").html(e);var a=$("#joueurs");a.empty(),t?(s.joueurs=[],$.get(i,function(e){var t=0,i=$(e).find(".player-row");i.each(function(){var e=$(this),t={};t.numero=e.find(".shirt-num").text(),t.nom=e.find(".container-player-row a").text(),t.place=e.find(".container-player-row div").text(),t.link=e.find(".container-player-row a").prop("href"),s.joueurs.push(t),a.append("<li><a href='#' class='joueur_link' data-url='"+t.link+"' data-nom=\""+t.nom+'">#'+t.numero+" "+t.nom+"</a></li>")}),equipe_now=s,n(s.joueurs)})):($.each(s.joueurs,function(e,t){a.append("<li><a href='#' class='joueur_link' data-url='"+t.link+"' data-nom=\""+t.nom+'">#'+t.numero+" "+t.nom+"</a></li>")}),equipe_now=s,n(s.joueurs))}function get_joueur(e,t,i,n){var s="";Array.isArray(equipe_now.joueurs)&&$.each(equipe_now.joueurs,function(t,i){i.nom==e&&(s=i)}),""==s?(t=!0,s={nom:e},Array.isArray(equipe_now.joueurs)&&equipe_now.joueurs.push(s)):void 0==s.joues&&(t=!0),$("#page_joueur h1").html(e);var a=$("#joueur");a.empty(),t?$.get(i,function(t){var i=0,o=$(t).find(".season-stats li");s.nom=e,s.joues=$(o[0]),s.gagnes=$(o[1]),s.perdus=$(o[2]),s.goals=$(o[3]),s.assists=$(o[4]),s.points=$(o[5]),s.joues.find("label").remove(),s.gagnes.find("label").remove(),s.perdus.find("label").remove(),s.goals.find("label").remove(),s.assists.find("label").remove(),s.points.find("label").remove(),s.joues=s.joues.text(),s.gagnes=s.gagnes.text(),s.perdus=s.perdus.text(),s.goals=s.goals.text(),s.assists=s.assists.text(),s.points=s.points.text(),a.append("<li><span>Matchs joués</span><span class='ul-li-count'>"+s.joues+"</span></li>"),a.append("<li><span>Matchs gagnés</span><span class='ul-li-count'>"+s.gagnes+"</span></li>"),a.append("<li><span>Matchs perdus</span><span class='ul-li-count'>"+s.perdus+"</span></li>"),a.append("<li><span>Goals</span><span class='ul-li-count'>"+s.goals+"</span></li>"),a.append("<li><span>Assists</span><span class='ul-li-count'>"+s.assists+"</span></li>"),a.append("<li><span>Points</span><span class='ul-li-count'>"+s.points+"</span></li>"),n(s),joueur_now=s}):(a.append("<li><a href='#'><span>Matchs joués</span><span class='ul-li-count'>"+s.joues+"</span></a></li>"),a.append("<li><a href='#'><span>Matchs gagnés</span><span class='ul-li-count'>"+s.gagnes+"</span></a></li>"),a.append("<li><a href='#'><span>Matchs perdus</span><span class='ul-li-count'>"+s.perdus+"</span></a></li>"),a.append("<li><a href='#'><span>Goals</span><span class='ul-li-count'>"+s.goals+"</span></a></li>"),a.append("<li><a href='#'><span>Assists</span><span class='ul-li-count'>"+s.assists+"</span></a></li>"),a.append("<li><a href='#'><span>Points</span><span class='ul-li-count'>"+s.points+"</span></a></li>"),n(s),joueur_now=s)}function get_match_du_jour(e,t){var i=$("#matchs_live");i.empty(),$.get(e,function(e){var n=0,s=$(e).find(".match-live li");if(s.length>0){var a="",o="",l="",u="",p="",d="",r="",c="";s.each(function(){$match=$(this),division="<h2 class='match_live_division'>"+$match.find(".div-name").html()+"</h2>",a=$match.find(".first-games-teams"),o=$(a[0]).find("img"),l=o.attr("src"),o=o.attr("title"),equipe1_el="<img src='"+l+"' alt=\""+o+"\" class='match_live_equipe' />",u=$(a[1]).find("img"),p=u.attr("src"),u=u.attr("title"),equipe2_el="<img src='"+p+"' alt=\""+u+"\" class='match_live_equipe' />",c="<div class='match_live_date'>"+$match.find(".dateandtime").html()+"</div>",d=$match.find(".score-live"),d=d.length>0?"<div class='match_live_score'>"+$(d[0]).html()+" - "+$(d[1]).html()+"</div>":"<div class='match_live_score'>pas débuté</div>",r=$match.find(".score-games-teams a").attr("href");var e=$("<li/>");e.data("url",r),e.append(division),e.append(c),e.append(equipe1_el),e.append(d),e.append(equipe2_el),e.append("<div class='match_live_equipe_texte'><strong>"+o+"</strong> vs <strong>"+u+"</strong></div>"),i.append(e)})}else i.append("<div>Pas de match aujourd'hui</div>");t()})}function init(){$(document).on("pageshow",setRealContentHeight),$(document).on("pageshow",function(){$(".nav-menu").load("menu.html",function(){$(".nav-menu").panel(),$(".nav-menu ul").listview(),$(".nav-menu").trigger("updatelayout")})}),$(document).on("click",".division",function(){$.mobile.loading("show",{text:"Chargement...",textVisible:!0,theme:"b",textonly:!1,html:""}),get_classement($(this).data("division"),!1,function(){document.location="#page_classement",$.mobile.loading("hide")})}),$(document).on("click",".equipe_link",function(){$.mobile.loading("show",{text:"Chargement...",textVisible:!0,theme:"b",textonly:!1,html:""}),get_equipe($(this).data("nom"),!1,$(this).data("url"),function(){document.location="#page_equipe",$("#page_equipe .joueurs").listview("refresh"),$.mobile.loading("hide")})}),$(document).on("click",".joueur_link",function(){$.mobile.loading("show",{text:"Chargement...",textVisible:!0,theme:"b",textonly:!1,html:""}),get_joueur($(this).data("nom"),!1,$(this).data("url"),function(){document.location="#page_joueur",$("#joueur").listview({splitTheme:"b"}),$("#joueur").listview("refresh"),$.mobile.loading("hide")})}),$(document).on("click","#page_classement .refresh",function(){$.mobile.loading("show",{text:"Chargement...",textVisible:!0,theme:"b",textonly:!1,html:""}),get_classement(division_now.nom,!0,function(){$.mobile.loading("hide")})}),$(document).on("click","#page_equipe .refresh",function(){$.mobile.loading("show",{text:"Chargement...",textVisible:!0,theme:"b",textonly:!1,html:""}),get_equipe(equipe_now.nom,!0,equipe_now.link,function(){$("#page_equipe .joueurs").listview("refresh"),$.mobile.loading("hide")})}),$(document).on("click",".nav-menu a.page_matchs_live",function(){$.mobile.loading("show",{text:"Chargement...",textVisible:!0,theme:"b",textonly:!1,html:""}),get_match_du_jour("http://www.fshbr.ch/",function(){$("#page_matchs_live .matchs_live").listview("refresh"),$.mobile.loading("hide")})})}function log(e){$(".console").append("<div>"+e+"</div>")}var urls={classement:{d1:"http://www.fshbr.ch/competitions/index/1",d2:"http://www.fshbr.ch/competitions/index/2",d3a:"http://www.fshbr.ch/competitions/index/3",d3b:"http://www.fshbr.ch/competitions/index/4",juniors:"http://www.fshbr.ch/competitions/index/5",novices:"http://www.fshbr.ch/competitions/index/6",minis:"http://www.fshbr.ch/competitions/index/7"}},divisions=[],division_now="",equipe_now="",joueur_now="";